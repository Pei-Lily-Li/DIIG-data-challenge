---
title: "DIIG Data Challenge"
author: "Lily Li"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo  =  TRUE,
                      warning = FALSE, 
                      message = FALSE)
```

## Load packages & data

```{r load-packages, message = FALSE}
library(tidyverse)
library(knitr)
library(broom)
library(ggplot2)
library(dplyr)
library(tidyr)

library(ggridges)
library(forcats)

IBM <- read_csv("data.csv")
```

## Guiding Questions

What factors contribute to employee satisfaction levels and what can IBM do to improve satisfaction? Do certain roles have greater employee churn? If so, what factors lead to this churn?

#### Look at relationship between JobInvolvement & Salary/Performance Rating

```{r}
involvement <- IBM %>%
  select(JobInvolvement, MonthlyIncome) %>%
  mutate(Involvement = case_when(
    JobInvolvement == 1 ~ "Low",
    JobInvolvement == 2 ~ "Medium",
    JobInvolvement == 3 ~ "High",
    JobInvolvement == 4 ~ "Very High",
  )) %>%
  group_by(Involvement) %>% 
  summarize(avg_income = mean(MonthlyIncome))

ggplot(involvement, aes(x = Involvement, y = avg_income, fill = Involvement)) + 
  geom_bar(stat = "identity") +
  scale_fill_hue(c = 60) +
  theme(legend.position="none") +
  coord_flip()
```

JobInvolvement & Salary: if people who are involved the most fairly rewarded?
Not very differentiated -- maybe can improve evaluation in terms of job involvement and reward those who have higher levels of involvement. Maybe can design monthly/seasonally evaluations to reward those with higher job involvement, so that employees can be more motivated.

**See if Job Involvement necessarily mean higher working hours**

So that we can determine if we should reward longer working hours or

```{r}

```

**YearsAtCompany vs. MonthlyIncome**

For those who have been working for a long time, if their income is not higher, then might need to think about what is causing this problem -- is it that employees are having a hard time getting promotion (structure change)? Or is it that they don't have a lot motivation (innovation approaches)? 

It would be better if employees know that if they work harder and stay at the firm longer, then they will be properly rewarded.

```{r}
ggplot(IBM, aes(x = YearsAtCompany, y = MonthlyIncome, color = Age)) + 
  geom_point() +
  geom_smooth(method=lm , color="red", fill="#69b3a2", se=TRUE) +
  scale_color_gradient(low="turquoise1", high="turquoise4")
  #theme_ipsum()
```

#### YearsInCurrentRole

See if employees are flexible between roles
If not, then might increase flexibility
If flexible, then maybe think about limiting role switch if want employees to gain expertise in one certain area.
This might answer the question of "How do you help people learn new things?"

```{r}
YearsAtRole <-IBM %>%
  select(JobRole, YearsInCurrentRole) %>%
  group_by(JobRole) %>% 
  summarize(AvgYearsAtRole = mean(YearsInCurrentRole))

ggplot(YearsAtRole, aes(x = JobRole, y = AvgYearsAtRole, fill = JobRole)) + 
  geom_bar(stat = "identity") +
  scale_fill_hue(c = 60) +
  theme(legend.position="none") +
  coord_flip()
```

#### Let's start with some basic demographic info

```{r}

```

#### Relationship Between Length at IBM & Work-life Balance

```{r}
yearsVedu <- IBM %>%
  mutate(College = case_when(
    Education == 1 ~ "Below College",
    Education == 2 ~ "College",
    Education == 3 ~ "Bachelor",
    Education == 4 ~ "Master",
    Education == 5 ~ "Doctor"
  ), !is.na(Education)) %>%
  select(College, YearsAtCompany)

ggplot(data=yearsVedu, aes(x=YearsAtCompany, group=College, fill=College)) +
  geom_density(adjust=1.5, alpha=.4)

ggplot(data=IBM, aes(x=YearsAtCompany, group=Gender, fill=Gender)) +
  geom_density(adjust=1.5, alpha=.4)
```

#### Emloyee Churn

```{r}
churn <- IBM %>%
  group_by(JobRole) %>% 
  summarize(AverageWorkYear = mean(YearsAtCompany))

ggplot(churn, aes(x = JobRole, y = AverageWorkYear, fill = JobRole)) + 
  geom_bar(stat = "identity") +
  scale_fill_hue(c = 40) +
  theme(legend.position="none") +
  coord_flip()
```

#### Satisfaction

```{r}
satisfaction <- IBM %>%
  select(JobRole, JobSatisfaction) %>%
  arrange(JobSatisfaction) %>%
  mutate(Satisfaction = case_when(
    JobSatisfaction == 1 ~ "Low",
    JobSatisfaction == 2 ~ "Medium",
    JobSatisfaction == 3 ~ "High",
    JobSatisfaction == 4 ~ "Very High"
  ))

ggplot(satisfaction, aes(x = JobRole, fill = Satisfaction)) +
  geom_bar(position="fill", stat="count") +
  scale_fill_hue(c = 60) +
  coord_flip()
```

Suggestion: mostly high job satisfaction in all roles -- 

#### Diversity & Inclusion

```{r}
gender <- IBM %>%
  select(Department, Gender)

role <- IBM %>%
  select(JobRole, Gender)

salary <- IBM %>%
  select(Gender, MonthlyIncome) %>%
  group_by(Gender) %>%
  summarize(avg_salary = mean(MonthlyIncome))
salary

marital <- IBM %>%
  select(MaritalStatus, MonthlyIncome) %>%
  group_by(MaritalStatus) %>%
  summarize(avg_salary = mean(MonthlyIncome))
marital

ggplot(gender, aes(x = Department, fill = Gender)) +
  geom_bar(position="stack", stat="count") +
  scale_fill_hue(c = 60) +
  coord_flip()

ggplot(role, aes(x = JobRole, fill = Gender)) +
  geom_bar(position="stack", stat="count") +
  scale_fill_hue(c = 60) +
  coord_flip()
```

Comment: generally doing pretty well in terms of diversity & inclusion
Suggestion: overall ok, but can higher more female in certain departments & roles.

### Questions

*HourlyRate*: hourly compensation
*Attrition*: leave voluntarily
* Make sure that understand each variable.
divide the variables to get new variables

These data are from the HR, so "performance rating" should be HR's rating on the employees. 
Client facing team
how much value can you generate from the data
be creative
graphs/tables

### Notes
   
Do some background info, IBM/working conditions, shows understanding
Come up with new questions
As a client, what do you think IMB would be interested in knowing
From the HR perspective

Do we need a lot of explanations in the output 


Formatting question:
would you suggest we knit it into a pdf or a webpage? When we submit the rmd file can it be a pdf so it's easier to look at?

You want to push yourself, explore

treat the presentation like you are presenting to business people
Should explain R^2 we should explain it in the context
Ability to give actionable suggestions
Don't just do stats presentations

Questions should be business-related

basically we can ask anything that might be helpful to the employer, you would recommend that...
what role would you apply for if you want to have higher wage. 
Design who do you want to answer the question to.

Far more important to have great visualizations.
